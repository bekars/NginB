CREATE TABLE `cesu_daily` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `bigzero` float NOT NULL DEFAULT '0',
  `fast` float NOT NULL DEFAULT '0',
  `slow` float NOT NULL DEFAULT '0',
  `same` float NOT NULL DEFAULT '0',
  `fastavg` float NOT NULL DEFAULT '0',
  `slowavg` float NOT NULL DEFAULT '0',
  `total` int(10) NOT NULL DEFAULT '0',
  `all_bigzero` float NOT NULL DEFAULT '0',
  `all_fastavg` float NOT NULL DEFAULT '0',
  `all_total` int(10) NOT NULL DEFAULT '0',
  `type` varchar(32) DEFAULT NULL,
  `time` datetime NOT NULL,
  PRIMARY KEY (`id`),
  KEY `index_time` (`time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `site_cesu_daily` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `site` varchar(500) NOT NULL,
  `rate` float NOT NULL DEFAULT '0',
  `cachehit` float NOT NULL DEFAULT '0',
  `type` varchar(32) DEFAULT NULL,
  `time` datetime NOT NULL,
  PRIMARY KEY (`id`),
  KEY `index_time` (`time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `cache_hit` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `cachehit` float NOT NULL DEFAULT '0',
  `cachehit_flow` float NOT NULL DEFAULT '0',
  `cacherate` float NOT NULL DEFAULT '0',
  `cacherate_flow` float NOT NULL DEFAULT '0',
  `hit` bigint(20) unsigned NOT NULL DEFAULT '0',
  `hit_flow` bigint(20) unsigned NOT NULL DEFAULT '0',
  `miss` bigint(20) unsigned NOT NULL DEFAULT '0',
  `miss_flow` bigint(20) unsigned NOT NULL DEFAULT '0',
  `expired` bigint(20) unsigned NOT NULL DEFAULT '0',
  `expired_flow` bigint(20) unsigned NOT NULL DEFAULT '0',
  `nocached` bigint(20) unsigned NOT NULL DEFAULT '0',
  `nocached_flow` bigint(20) unsigned NOT NULL DEFAULT '0',
  `total` bigint(20) unsigned NOT NULL DEFAULT '0',
  `total_flow` bigint(20) unsigned NOT NULL DEFAULT '0',
  `time` datetime NOT NULL,
  PRIMARY KEY (`id`),
  KEY `index_time` (`time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `site_pv_info` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `site` varchar(500) NOT NULL,
  `pv` bigint(20) unsigned NOT NULL DEFAULT '0',
  `time` datetime NOT NULL,
  PRIMARY KEY (`id`),
  KEY `index_record_id` (`site`(255)),
  KEY `index_time` (`time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `speed_data_analysis` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `role_id` bigint(20) NOT NULL,
  `role_name` varchar(500) NOT NULL,
  `total_rate` float NOT NULL DEFAULT '0',
  `tcp_rate` float NOT NULL DEFAULT '0',
  `response_rate` float NOT NULL DEFAULT '0',
  `download_rate` float NOT NULL DEFAULT '0',
  `aqb_ip` varchar(32) NOT NULL,
  `org_ip` varchar(32) NOT NULL,
  `city_code` int(11) NOT NULL,
  `time_interval` int(10) NOT NULL DEFAULT 0,
  `time` datetime NOT NULL,
  PRIMARY KEY (`id`),
  KEY `index_city` (`city_code`),
  KEY `index_time` (`time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


CREATE TABLE `cluster_cesu_daily` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `ipseg` varchar(500) NOT NULL,
  `total_rate` float NOT NULL DEFAULT '0',
  `count` int(10) NOT NULL DEFAULT '0',
  `percent` float NOT NULL DEFAULT '0',
  `time` datetime NOT NULL,
  PRIMARY KEY (`id`),
  KEY `index_time` (`time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `cluster_cesu_hour` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `dailyid` bigint(20) unsigned NOT NULL,
  `clock` time NOT NULL,
  `ipseg` varchar(500) NOT NULL,
  `total_rate` float NOT NULL DEFAULT '0',
  `count` int(10) NOT NULL DEFAULT '0',
  `time` datetime NOT NULL,
  PRIMARY KEY (`id`),
  KEY `index_time` (`time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `speed_task` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `type` tinyint(4) NOT NULL DEFAULT '0',
  `aqb_role_id` bigint(20) NOT NULL,
  `ip_role_id` bigint(20) NOT NULL,
  `site` varchar(500) DEFAULT NULL,
  `ip` varchar(100) DEFAULT NULL,
  `cesu` tinyint(2) unsigned DEFAULT NULL,
  `dnspod` tinyint(2) unsigned DEFAULT NULL,
  `task_status` tinyint(4) NOT NULL DEFAULT '1',
  `role_status` tinyint(4) NOT NULL DEFAULT '0',
  `enable_flag` tinyint(4) NOT NULL DEFAULT '1',
  `in_owdb_flag` tinyint(4) NOT NULL DEFAULT '1',
  `time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `index_aqb_role_id` (`aqb_role_id`),
  KEY `index_ip_role_id` (`ip_role_id`),
  KEY `index_site` (`site`(255))
) ENGINE=InnoDB DEFAULT CHARSET=utf8

CREATE TABLE `speed_task_type` (
  `type` tinyint(4) NOT NULL,
  `name` varchar(32) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


delimiter //
CREATE function fun_ipseg(ipaddr varchar(32))
returns varchar(32)
begin
    declare ip_seg varchar(32);
    set ip_seg = substring_index(ipaddr, ".", 3);
    return ip_seg;
end
//

delimiter ;


CREATE TABLE `ip` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `cnt` bigint(20) unsigned NOT NULL DEFAULT '0',
  `ip` varchar(100) NOT NULL,
  `ipnum` int(20) unsigned NOT NULL,
  `country` varchar(32) NOT NULL,
  `country_id` varchar(16) NOT NULL,
  `area` varchar(32) NOT NULL,
  `area_id` int(20) DEFAULT NULL,
  `region` varchar(32) NOT NULL,
  `region_id` int(20) DEFAULT NULL,
  `city` varchar(32) NOT NULL,
  `city_id` int(20) DEFAULT NULL,
  `county` varchar(32) NOT NULL,
  `county_id` int(20) DEFAULT NULL,
  `isp` varchar(32) NOT NULL,
  `isp_id` int(20) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `index_ip` (`ip`),
  KEY `index_ipnum` (`ipnum`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


